# 系统设计总结


| 项目                      | 数据库                                                       | 关键问题                                                     | 数据分片                                                     | Cache                       |
| ------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | --------------------------- |
| 1.概述                    |                                                              |                                                              |                                                              |                             |
| 2.TinyURL                 | NoSQL                                                        | Hash方式选择，考虑容量、数量<br />离线预生产Key              | 按首字母：数据不均匀<br />按hash分：ok                       | 淘汰策略：LRU               |
| 3.Pastebin                | MySQL or NoSQ(元信息)<br />对象存储(数据)                    | 离线预生产Key                                                | 同上                                                         | 同上                        |
| 4.Instagram               | 对象存储or HDFS(数据)<br />NoSQL(PhotoID=>metadata)<br /> wide-column datastore (relationship[user with phots and user follow]) | 推(粉丝多的人)拉(粉丝少的人)结合                             | UserID：不均匀<br />PhoteId:ok 可以离线预生成PhotoID         | CDN<br />LRU<br />80-20原则 |
| 5.Dropbox                 | MySQL(ACID)                                                  | 数据分片：备份成本与同步速度<br /> 保持长连接：long polling<br />同步数据时需要用消息队列来削峰<br />数据去重：实时去重 or 异步去重 | 垂直分区（用户信息与文件信息分开）：一致性、扩展性l<br />按首字母：数据不均匀<br />按Hash分：ok | Memcached<br />LRU          |
| 6.Facebook Messenger      | HBase：column-oriented key-value NoSQL                       | Pull or Push？Push每个client都需要和server建立长链接（long polling or webscokets）<br /> 在线状态可以按需取用，不一定需要实时更新 | UserID：ok<br />MessageID：获取一串信息将非常慢              |                             |
| 7.Twitter                 | 同Instagram                                                  |                                                              | UserID：热门用户导致数据不均匀<br />TwitterId：查询一个用户的一串信息时，非常慢<br />按时间：读很友好，但是写基本都是写到最近的服务器，不均匀<br />按时间+TwitterId：把twitterId设计成时间+序号的方式 |                             |
| 8.Youtube or Netflix      | MySQL：metadata<br />HDFS：video<br />BigTable：trumbnails   | 读写分离<br />视频去重可以分块去                             | UserID：热门用户导致数据不均匀<br />VideoId：查询视频时需扫描所有服务器，然后做merge；加cache缓解 |                             |
| 9.Typeahead Suggestion    |                                                              |                                                              |                                                              |                             |
| 10.API Rate Limiter       |                                                              | 固定窗口(`hash[userid][ip][x秒] => count`)<br />滑动窗口(`hash[userid][ip][1/60单位] => count`) |                                                              |                             |
| 11.Twitter Search         |                                                              |                                                              |                                                              |                             |
| 12.Web Crawler            |                                                              |                                                              |                                                              |                             |
| 13.Facebook Newsfeed      |                                                              |                                                              |                                                              |                             |
| 14.Yelp or Nearby Friends |                                                              |                                                              |                                                              |                             |
| 15.Uber backend           |                                                              |                                                              |                                                              |                             |
| 16.总结                   |                                                              |                                                              |                                                              |                             |

参考资料：https://www.educative.io/courses/grokking-the-system-design-interview
