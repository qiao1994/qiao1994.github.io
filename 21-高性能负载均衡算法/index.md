# 21.高性能负载均衡：算法

# 分类
负载均衡算法大致能分为以下几类：
* 任务平分类
* 负载均衡类
* 性能最优类
* Hash类

# 算法
## 轮询
### 优点
* 简单

### 缺点
* 无法感知到机器自身的状态和负载，只有机器宕机或失联才能感知

## 加权轮询
### 优点
* 能把服务器处理能力差异考虑到轮询算法中（配置）

### 缺点
* 依然无法把服务器的状态加入考虑

## 负载最低优先
这里的`负载`根据业务场景不同，指标也不尽相同；可能是cpu负载、内存负载、连接数等等
### 优点
* 解决了轮询算法中无法感知服务器状态的问题

### 缺点
* 复杂度上升（因为需要感知服务器状态，就要求服务器上报状态）

## 性能最优
优先把请求分配给响应最快的服务器
### 优点
* 同负载最低优先一样，也能感知服务器状态（只是通过响应时间来感知的）

### 缺点
* 复杂度上升（需要收集每个服务器每个任务的响应时间）
	* 收集和统计本身比较耗费资源
   * 为了减少统计上的消耗，可以不收集全部信息，通过抽样的方式来收集信息；这就涉及到采样率的选取，太低会导致结果不准确，太高会导致性能消耗较大。
   * 需要选择合适的周期


## Hash
Hash是指对请求的某个指标做Hash，然后对Hash值取模，根据取模结果把请求分配到某台机器上。
这种算法主要是为了满足某种特殊诉求，比如相同user_id的请求要打到同一台机器上，或者相同ip的请求打到同一台机器上。
