# 18.单服务器高性能模式：PPC与TPC

服务器高性能的关键之一就是服务器采取的并发模型，并发模型有如下两个关键设计点：
* 服务器如何管理连接
* 服务器如何处理请求
以上两个设计点最终都和操作系统的I/O模型及进程模型相关：
* I/O模型：阻塞、非阻塞、同步、异步
* 进程模型：单进程、多进程、多线程

# PPC:Process Per Connection
每次有新的链接就新建一个进程去专门处理这个连接的请求。

## 优势
* 实现简单

## 问题
* fork代价高
* 父子进程通信复杂
* 支持的并发连接数量有限

## prefork
提前创建进程

# TPC:Thread Per Connection
每次有新的连接就新建一个专门的线程去专门处理这个连接的请求。

## 优势
* 解决了fork代价高和进程通信复杂的问题

## 问题
* 创建线程依然有代价，高并发时还是有性能问题
* 无需进程间通信，但是线程间的互斥和共享又引入了复杂度
* 多线程会互相影响，某个线程出现异常时，可能导致整个进程退出
除了引入新的问题，TPC还存在CPU线程调度和切换代价的问题，因此，TPC本质上和PPC类似，在并发几百的场景下，反而更多地是采用PPC方案，因为PPC方案不会有死锁的风险，也不会有多进程互相影响，稳定性更高。

## prethread
提前创建线程
