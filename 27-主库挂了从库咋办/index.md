# 27.主库挂了从库咋办


## 基于位点的主备切换

A是主库，A'是备库；B、C、D是从库；当主库要从A切换为A'时，BCD需要知道应该继续从A'的binlog的哪个位点开始执行。

但是无法获取到精准的位点，只能记录下A宕机的时刻T，再从A'的T时刻开始执行，这里的位点是偏前的，因此可能会出现主键冲突等问题，因此需要临时关闭主键冲突、删除行不存在等错误的报警，待同步平稳后再打开。

## GTID

GTID全称是Global Transaction Identifier，也就是全局事务ID，是一个事务在提交的时候生成的，是这个事务的唯一标识。

通过GTID来给每个事务做标记，每个实例都用GTID来记录自己执行了哪些事务，这样当出现主备切换时，只需要判断自己是否执行过GTID来判断是否要跳过某些事务。


