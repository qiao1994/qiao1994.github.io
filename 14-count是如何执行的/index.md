# 14.count是如何执行的


## count(*)的实现方式
* MyISAM引擎把一个表的总行数存在了磁盘上，因此执行count(*)的时候会直接返回这个数，效率很高；
* 而InnoDB引擎就麻烦了，它执行count(*)的时候，需要把数据一行一行地从引擎里面读出来，然后累积计数。

## 为什么InnoDB不跟MyISAM一样，也把数字存起来呢
* 由于多版本并发控制（MVCC）的原因，InnoDB表“应该返回多少行”也是不确定的
> 在执行count(*)操作的时候，innodb会扫描普通索引，因为普通索引的叶节点是主键id，比较小

## 用缓存系统保存计数
* 第一个问题：缓存系统可能会计数不准确(宕机时丢失数据)，可以通过每次启动时统一次来做修复。
* 第二个问题：插入数据和给缓存系统加一是分开的，这中间的gap可能有逻辑不一致的问题。
  * 解决办法：单独用一个表来计数，通过事务来解决gap的问题。

## 不同count的处理逻辑
* count(*)、count(主键id)和count(1) 都表示返回满足条件的结果集的总行数；而count(字段），则表示返回满足条件的数据行里面，参数“字段”不为NULL的总个数。
* 效率排序：count(字段)<count(主键id)<count(1)≈count(*)
